<div class="container">
  <h1 class="mt-5">{{product_type}} products</h1>
  <div class="site-section mt-4">
    <div class="container">
      <div class="row">
        <a
          data-mdb-ripple-init
          data-mdb-modal-init
          href="#addProduct"
          class="mb-3 fs-20"
        ><i class="icon ion-md-create">Add new product</i></a>
      </div>
      <div
        class="modal fade"
        id="addProduct"
        aria-hidden="true"
        aria-labelledby="addProductLabel"
        tabindex="-1"
      >
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="addProductLabel">Add new product</h5>
              <button
                type="button"
                class="btn-close"
                data-mdb-ripple-init
                data-mdb-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">
              <form class="ml-3" action="/product/add" enctype="multipart/form-data" method="post">
                <div class="input-group">
                  <label class="fw-bold" for="image_link">Image</label>
                  <input
                    class="input--style-3"
                    type="text"
                    name="image_link"
                    placeholder="Image link" required
                  />
                  <label class="fw-bold" for="brand">Brand</label>
                  <input
                    class="input--style-3"
                    type="text"
                    name="brand"
                    placeholder="Brand name" required
                  />
                </div>
                <div class="input-group">
                  <label class="fw-bold" for="name">Name</label>
                  <input
                    class="input--style-3"
                    type="text"
                    name="name"
                    placeholder="Product name" required
                  />
                </div>
                <div class="input-group">
                  <label class="fw-bold" for="price">Price</label>
                  <input
                    class="input--style-3"
                    type="text"
                    name="price"
                    placeholder="Price" required
                  />
                </div>

                <input
                  type="hidden"
                  name="product_type"
                  value="{{product_type}}"
                />
                <div class="input-group">
                  <label class="fw-bold" for="name">Description</label>
                  <input
                    class="input--style-3"
                    type="text"
                    name="description"
                    placeholder="Description" required
                  />
                </div>
                <input type="hidden" name="_csrf" value="{{csrfToken}}" />
                <div class="ms-3 mb-3">
                  <button
                    class="btn btn--pill btn--green mb-3"
                    type="submit"
                  >Confirm</button>
                </div>
              </form>

            </div>
          </div>
        </div>
      </div>
      <div class="row mb-5">
        <div class="dropdown">
          <button
            class="dropdown-toggle"
            type="button"
            id="dropdownMenuButton"
            data-toggle="dropdown"
            aria-haspopup="true"
            aria-expanded="false"
          >
            Filter
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            <a class="dropdown-item" href="/product/filter?cate={{product_type}}&filter=A_Z">A-Z</a>
            <a class="dropdown-item" href="/product/filter?cate={{product_type}}&filter=Z_A">Z-A</a>
            <a class="dropdown-item" href="/product/filter?cate={{product_type}}&filter=Price_low_to_high">Price low to high</a>
            <a class="dropdown-item" href="/product/filter?cate={{product_type}}&filter=Price_high_to_low">Price high to low</a>
          </div>
        </div>
      </div>
      <div class="row">
        {{#each prodList}}
          <div class="col-lg-4 mb-5 col-md-6 product">
            <div class="wine_v_1 text-center pb-4">
              <a
                href="/product/detail?id={{this.id}}"
                id="show-detail"
                class="thumbnail d-block mb-4"
              >
                <img
                  src="{{this.image_link}}"
                  alt="{{this.name}}"
                  class="img-fluid"
                />
              </a>
              <div class="wine-actions">
                <h3 class="heading-2 product-text" style="font-size:18px"><a
                    href
                  >{{this.name}}</a></h3>
                <h3 class="heading-2 product-text" style="font-size:15px">
                  {{this.price}}{{this.price_sign}}
                </h3>
              </div>
            </div>
            <style>
              .edit-button i, .delete-button i { font-size: 20px; /* Điều chỉnh
              kích thước biểu tượng theo mong muốn */ }
            </style>
            <div class="text-center">
              <a
                data-mdb-ripple-init
                data-mdb-modal-init
                href="#editProduct{{this.id}}"
                class="mr-3 edit-button"
              ><i class="icon ion-md-create"></i></a>
              <a
                href="/product/delete?id={{this.id}}&product_type={{product_type}}"
                class="ml-3 delete-button"
              ><i class="icon ion-md-trash"></i></a>
            </div>
          </div>
          <div
            class="modal fade"
            id="editProduct{{this.id}}"
            aria-hidden="true"
            aria-labelledby="editProduct{{this.id}}Label"
            tabindex="-1"
          >
            <div class="modal-dialog modal-dialog-centered">
              <div class="modal-content">
                <div class="modal-header">
                  <h5
                    class="modal-title"
                    id="editProduct{{this.id}}Label"
                  >Editing {{this.name}}</h5>
                  <button
                    type="button"
                    class="btn-close"
                    data-mdb-ripple-init
                    data-mdb-dismiss="modal"
                    aria-label="Close"
                  ></button>
                </div>
                <form
                  class="ml-3"
                  action="/product/edit/{{this.id}}"
                  method="post"
                >
                  <div class="fw-bold mb-2" class="input-group">
                    <input
                      class="input--style-3"
                      type="hidden"
                      name="id"
                      value="{{this.id}}" required
                    />
                  </div>
                  <div class="input-group">
                  <label class="fw-bold" for="image_link">Image</label>
                  <input
                    class="input--style-3"
                    type="text"
                    name="image_link"
                    placeholder="Image link"
                    value="{{this.image_link}}" required
                  />
                  </div>
                  <div class="input-group">
                    <label class="fw-bold" for="brand">Brand</label>
                    <input
                      class="input--style-3"
                      type="text"
                      name="brand"
                      value="{{this.brand}}" required
                    />
                  </div>
                  <div class="input-group">
                    <label class="fw-bold" for="name">Name</label>
                    <input
                      class="input--style-3"
                      type="text"
                      name="name"
                      value="{{this.name}}" required
                    />
                  </div>
                  <div class="input-group">
                    <label class="fw-bold" for="price">Price</label>
                    <input
                      class="input--style-3"
                      type="text"
                      name="price"
                      value="{{this.price}}" required
                    />
                  </div>
                  <div class="input-group">
                    <label class="fw-bold" for="description">Description</label>
                    <input
                      class="input--style-3"
                      type="text"
                      name="description"
                      value="{{this.price}}" required
                    />
                  </div>
                  <input
                    type="hidden"
                    name="product_type"
                    value="{{product_type}}" required
                  />

                  <input type="hidden" name="_csrf" value="{{csrfToken}}" />
                  <div class="ms-3 mb-3">
                    <button
                      class="btn btn--pill btn--green"
                      type="submit"
                    >Confirm</button>
                  </div>

                </form>

                <div class="modal-footer">
                </div>
              </div>
            </div>
          </div>
        {{/each}}

      </div>
    </div>
  </div>

  <nav aria-label="Page navigation example">
    <ul id="prod-pagination" class="pagination flex-wrap d-flex justify-content-center">
      <li class="page-item mx-1"><a class="page-link page-previous" href="">Previous</a></li>
      {{!-- <li class="page-item"><a class="page-link" href="/product?cate={{product_type}}&page=1">1</a></li>
      <li class="page-item"><a class="page-link" href="/product?cate={{product_type}}&page=2">2</a></li>
      <li class="page-item"><a class="page-link" href="/product?cate={{product_type}}&page=3">3</a></li> --}}
      <li class="page-item mx-1"><a class="page-link page-next" href="">Next</a></li>
    </ul>
  </nav>

</div>
<style>

</style>
<script>
  const page = {{ page }};
  const total = {{ total }};
  const product_type = '{{ product_type }}';
  const per_page = 9;
  const total_page = Math.ceil(total / per_page);
  const pagination = document.getElementById('prod-pagination');
  let html = ''

  //Generate page button in pagination
  for (let i = 1; i <= total_page; ++i) {
    html += `<li class="page-item"><a class="page-link page-number" href="/product?cate=${product_type}&page=${i}">${i}</a></li>`
  }
  pagination.lastElementChild.insertAdjacentHTML('beforebegin', html);
  const pageNumbers = document.querySelectorAll('.page-number');
  pageNumbers[page-1].focus();
  //Handle previous button
  const previousPage = document.querySelector('.page-previous');
  const nextPage = document.querySelector('.page-next');
  console.log(previousPage);

  let previous_page = page > 1 ? page - 1 : total_page;
  let next_page = page >= total_page ? 1 : page + 1;
  previousPage.setAttribute('href', `/product?cate=${product_type}&page=${previous_page}`)
  nextPage.setAttribute('href', `/product?cate=${product_type}&page=${next_page}`)
</script>